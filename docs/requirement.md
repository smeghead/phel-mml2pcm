# 要件定義: Phel による MML → WAV 変換コマンドラインツール

## 概要

このプロジェクトは、Phel-lang を用いて、簡易的な音声合成ツールを実装することを目的とします。Music Macro Language (MML) 形式の文字列を標準入力から受け取り、それを解析・合成し、16bit PCM の WAV 形式として標準出力に出力するコマンドラインツールを作成します。

## 主な機能

- **MML入力**:
  - ユーザーが MML (Music Macro Language) 形式の文字列を標準入力に渡す。
  - 例: `t120 o5 c d e f g a b > c`

- **MMLパーサー**:
  - 音長 (`l`)、音符 (`a`〜`g`)、オクターブ (`o`)、テンポ (`t`)、休符 (`r`) などの構文を解釈。
  - `<` `>` でオクターブの上げ下げもサポート。

- **波形生成**:
  - 各音符の周波数を計算し、sin 波を使って音波データを生成。
  - `np.sin` 相当の波形計算を Phel 上で行う。
  - サンプリングレート（例：44100Hz）とビット深度（16bit）に対応。

- **PCMバッファの構築**:
  - 波形を16bit PCM形式のバッファに変換。
  - 正規化して符号付き整数値にスケーリング。

- **WAVフォーマットの出力**:
  - WAVフォーマットのヘッダと音声データを組み合わせて、標準出力にバイナリ出力。
  - 音声再生やファイル保存は `> out.pcm` のようにリダイレクトで対応可能。

## 非機能要件

- 依存ライブラリに極力頼らず、純粋な Phel のみで完結させる（可能な限り）。
- 外部ライブラリ使用時は明記する。
- クロスプラットフォーム（Linux/Mac/Windows）を意識した実装。
- 動作確認には WAV 出力をプレイヤーで再生して確認。

## 目的・意義

- PHP での音声合成の代替技術検討の一環。
- 音の仕組み（sin/cos 波形、周波数、音階）を学ぶ教育的ツール。
- 関数型プログラミング言語である Phel を活用した音声処理の可能性検証。

## 今後の拡張案（スコープ外）

- 複数音の同時発音（和音）対応。
- ADSR エンベロープの導入。
- GUI での MML 作曲支援。
- 音色の変更（矩形波、ノコギリ波など）。

